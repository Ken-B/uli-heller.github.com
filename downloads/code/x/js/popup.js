var bgmodule=chrome.extension.getBackgroundPage();var config=bgmodule.g_config;var type_default=["main_frame","sub_frame","stylesheet","script","image","object","xmlhttprequest","other"];var type_default_text=["Main frame","Sub frame","Stylesheet","Script","Image","Object","xmlhttprequest","Other"];var g_current_url="";function init(){var b=document.getElementById("change_enable");b.checked=config.change_enable;var b=document.getElementById("req_pattern_enable2");b.checked=config.req_pattern_enable2;var b=document.getElementById("log_enable");b.checked=config.log_enable;var b=document.getElementById("other_autorefresh");b.checked=toBool(localStorage.other_autorefresh);if(config.current_uaidx<0){var g="<label><input type='radio' name='ua_data_sel' id='fix1_3' value='-1' checked>"+_i18n("msg_defaultchrome")+"</label>"}else{var g="<label><input type='radio' name='ua_data_sel' id='fix1_3' value='-1'>"+_i18n("msg_defaultchrome")+"</label>"}var f;for(var e=0;e<config.ua_data.length;e++){var b=config.ua_data[e];if(b.hide){continue}if(config.current_uaidx==e){f=" checked"}else{f=""}if(g!=""){g=g+"<br>"}g=g+"<label><input type='radio' name='ua_data_sel' id='fix1_4_"+e+"' value='"+e+"'"+f+">"+b.name+"</label>"}var b=document.getElementById("ua_data");b.innerHTML=g;_getid("fix1_3").onclick=function(){ua_data_sel_onclick(this)};for(var e=0;e<config.ua_data.length;e++){var b=_getid("fix1_4_"+e);if(b){b.onclick=function(){ua_data_sel_onclick(this)}}}var b=config.change_type;var f="";for(var d=0;d<b.length;++d){for(var c=0;c<type_default.length;++c){if(b[d]==type_default[c]){if(f!=""){f=f+", "}f=f+type_default_text[c];break}}}if(f==""){f=_i18n("conf_none")}var b=document.getElementById("change_type");b.innerHTML="&nbsp;"+_i18n("msg_filter")+": <font color=green>"+f+"</font>";proc_updateui();chrome.windows.getLastFocused(function(a){chrome.tabs.getSelected(a.id,function(h){g_current_url=h.url})})}function ua_data_sel_onclick(a){bgmodule.proc_updatecurrent(a.value);proc_refreshtab()}function proc_refreshtab(){if(!toBool(localStorage.other_autorefresh)){return}chrome.windows.getLastFocused(function(a){chrome.tabs.getSelected(a.id,function(b){if(g_current_url==""){chrome.tabs.update(b.id,{url:b.url})}else{chrome.tabs.update(b.id,{url:g_current_url})}})})}function proc_updateui(){var e=document.getElementById("change_enable");var d=true;if(e.checked){d=false}var c=document.getElementsByTagName("*");for(var f=0;f<c.length;f++){if(c[f]==e){continue}switch(c[f].tagName){case"INPUT":case"SELECT":c[f].disabled=d;break}}}function other_autorefresh_onchange(){var b=document.getElementById("other_autorefresh");localStorage.other_autorefresh=b.checked;if(b.checked){proc_refreshtab()}}function change_enable_onchange(){var b=document.getElementById("change_enable");localStorage.change_enable=b.checked;config.change_enable=b.checked;bgmodule.proc_init(true);proc_updateui();proc_updateconfig();proc_refreshtab()}function req_pattern_enable_onchange(){var b=document.getElementById("req_pattern_enable2");localStorage.req_pattern_enable2=b.checked;config.req_pattern_enable2=b.checked;proc_updateconfig();proc_refreshtab()}function log_enable_onchange(){var b=document.getElementById("log_enable");localStorage.log_enable=b.checked;config.log_enable=b.checked;proc_updateconfig()}function proc_updateconfig(){chrome.windows.getAll({populate:true},function(e){for(var b=0;b<e.length;b++){var f=e[b];for(var a=0;a<f.tabs.length;a++){var d=f.tabs[a];var c=d.url;if(c){c=c.toLowerCase();if(c.indexOf("://"+bgmodule.g_extensionid)>=0){chrome.tabs.sendRequest(d.id,{action:"config_changed"},null)}}}}})}function proc_onload(){proc_setlang();document.ondragstart=function(){return false};_getid("change_enable").onchange=change_enable_onchange;_getid("req_pattern_enable2").onchange=req_pattern_enable_onchange;_getid("log_enable").onchange=log_enable_onchange;_getid("other_autorefresh").onchange=other_autorefresh_onchange;_getid("fix1_1").onclick=function(){open_newtab_extension("options.html");return false};_getid("fix1_2").onclick=function(){open_newtab_extension("viewlog.html");return false};init()}window.onload=proc_onload;