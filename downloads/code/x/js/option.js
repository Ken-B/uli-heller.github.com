var bgmodule=chrome.extension.getBackgroundPage();var gisdefault=false;function set_notsaved(){document.getElementById("status").innerHTML="&nbsp;"+chrome.i18n.getMessage("conf_notsaved");document.getElementById("status2").innerHTML="&nbsp;"+chrome.i18n.getMessage("conf_notsaved")}function set_saved(){document.getElementById("status").innerHTML="&nbsp;"+chrome.i18n.getMessage("conf_saved");document.getElementById("status2").innerHTML="&nbsp;"+chrome.i18n.getMessage("conf_saved")}function proc_hotkey1_out(){return'<option value="">'+chrome.i18n.getMessage("conf_none")+'</option><option value="alt">Alt</option><option value="ctrl">Ctrl</option><option value="ctrl+shift">Ctrl+Shift</option><option value="ctrl+alt">Ctrl+Alt</option>'}function proc_hotkey2_out(){var a='<option value="">'+chrome.i18n.getMessage("conf_none")+"</option>";for(i=1;i<=10;i++){a+='<option value="'+(111+i)+'">F'+i+"</option>"}for(i=48;i<=57;i++){s=String.fromCharCode(i);a+='<option value="'+i+'">'+s+"</option>"}for(i=65;i<=90;i++){s=String.fromCharCode(i);a+='<option value="'+i+'">'+s+"</option>"}return a}function presetValues_bool(b,a){if(gisdefault){document.getElementById(b).checked=bgmodule.getStorageDefaults(a)}else{document.getElementById(b).checked=toBool(localStorage[a])}document.getElementById(b).onchange=function(){set_notsaved()}}function presetValues2(b,a){if(gisdefault){document.getElementById(b).value=bgmodule.getStorageDefaults(a)}else{document.getElementById(b).value=toSafeString(localStorage[a])}document.getElementById(b).onchange=function(){set_notsaved()}}function presetValues(h){gisdefault=h;try{for(var e=0;e<type_default.length;++e){var c=document.getElementById("change_type_"+type_default[e]);if(c){c.checked=false;c.onchange=function(){set_notsaved()}}}if(gisdefault){var f=bgmodule.getStorageDefaults("change_type")}else{var f=localStorage.change_type}var d=JSON.parse(f);for(var e=0;e<d.length;++e){var c=document.getElementById("change_type_"+d[e]);if(c){c.checked=true}}}catch(g){}if(gisdefault){ua_data_make()}ua_data_load();presetValues_bool("req_pattern_enable2","req_pattern_enable2");if(gisdefault){req_pattern_make()}req_pattern_load();presetValues2("viewlog_refreshhotkey","viewlog_refreshhotkey");presetValues2("viewlog_refreshhotkey2","viewlog_refreshhotkey2");presetValues2("viewlog_clearhotkey","viewlog_clearhotkey");presetValues2("viewlog_clearhotkey2","viewlog_clearhotkey2")}function setdefault(){presetValues(true);set_notsaved()}function saveOptions(){var f=[];for(var d=0;d<type_default.length;++d){var a=document.getElementById("change_type_"+type_default[d]);if(a){if(a.checked){f[f.length]=type_default[d]}}}localStorage.change_type=JSON.stringify(f);var e=JSON.stringify(ua_data);localStorage.ua_data=e;localStorage.req_pattern_enable2=document.getElementById("req_pattern_enable2").checked;var e=JSON.stringify(req_pattern);localStorage.req_pattern=e;localStorage.viewlog_refreshhotkey=document.getElementById("viewlog_refreshhotkey").value;localStorage.viewlog_refreshhotkey2=document.getElementById("viewlog_refreshhotkey2").value;localStorage.viewlog_clearhotkey=document.getElementById("viewlog_clearhotkey").value;localStorage.viewlog_clearhotkey2=document.getElementById("viewlog_clearhotkey2").value;bgmodule.g_config.load();bgmodule.proc_updatecurrent(null);set_saved();show_message("<label2><font style='font-size:13px'>"+chrome.i18n.getMessage("conf_saved")+"</font></label2>")}function closeoption(){chrome.windows.getLastFocused(function(b){var a=b.id;chrome.tabs.getSelected(a,function(c){chrome.tabs.remove(c.id)})})}function other_onkeydown(f){var d=f.keyCode;var c=typeof f.modifiers=="undefined"?f.ctrlKey:f.modifiers&Event.CONTROL_MASK;var b=typeof f.modifiers=="undefined"?f.altKey:f.modifiers&Event.ALT_MASK;var a=typeof f.modifiers=="undefined"?f.shiftKey:f.modifiers&Event.SHIFT_MASK;if(b){if(d==112){saveOptions()}}}function init(){document.addEventListener("keydown",other_onkeydown);windowonscroll()}var ua_data=[];var ua_data_current_idx=-1;var c_sel_color="#F2FFF2";function ua_data_make(){try{if(gisdefault){if(ua_data.length>0){return}s=bgmodule.getStorageDefaults("ua_data")}else{s=localStorage.ua_data}ua_data=[];ua_data=JSON.parse(s)}catch(c){}var b=document.getElementById("btn_ua_data_edit");b.disabled=true}function ua_data_load(){var f='<table width=100% border="1" cellpadding="3" cellspacing="2" bordercolor="silver" style="border-collapse:collapse"><tr><td><b>Flag</b><td><b>'+_i18n("msg_name")+"</b><td><b>"+_i18n("msg_agentstring")+"</b>";f+="<td>";f+='<td colspan=2 align=center><a id="fix1_15" href="#" class=alinktext title="'+_i18n("msg_moveup")+'"><img src="images/up.png"></a>&nbsp;&nbsp;<a id="fix1_16" href="#" class=alinktext title="'+_i18n("msg_movedown")+'"><img src="images/down.png"></a>';if(ua_data.length==0){f=f+"<tr><td colspan=100>No data</td></tr>"}var e;for(var d=0;d<ua_data.length;++d){f+='<tr id="tr_ua_data_'+d+'">';f+="<td>"+ua_data[d].ab+"</td><td>"+ua_data[d].name+"</td><td>"+ua_data[d].uastring+"</td>";e="";if(ua_data[d].hide){e="checked"}f+='<td><label><input type=checkbox id="fix1_19_'+d+'" title="'+_i18n("msg_hidefromlist")+'" '+e+"></label></td>";f+='<td><label><input type=radio id="fix1_17_'+d+'" name=uasel title="'+_i18n("msg_select")+'"></label></td>';f+='<td><a id="fix1_18_'+d+'" href="#" class=alinktext title="'+_i18n("msg_delete")+'"><img src="images/close.png"></a></td></tr>';f+="</tr>"}f=f+"</table>";var b=document.getElementById("ua_data");b.innerHTML=f;_getid("fix1_15").onclick=function(){ua_data_move(0);return false};_getid("fix1_16").onclick=function(){ua_data_move(1);return false};for(var d=0;d<ua_data.length;++d){var b=_getid("fix1_17_"+d);if(b){b.data=d;b.onclick=function(){ua_data_edit(this.data)}}var b=_getid("fix1_18_"+d);if(b){b.data=d;b.onclick=function(){ua_data_del(this.data);return false}}var b=_getid("fix1_19_"+d);if(b){b.data=d;b.onclick=ua_data_hide}}var b=document.getElementsByName("uasel");for(var d=0;d<b.length;d++){if(ua_data_current_idx==d){b[d].checked=true;var g=document.getElementById("tr_ua_data_"+d);if(g){g.bgColor=c_sel_color}break}}}function ua_data_reload(){ua_data_current_idx=-1;ua_data_load();var b=document.getElementById("btn_ua_data_edit");b.disabled=true;set_notsaved()}function ua_data_clearall(){var a=confirm(_i18n("msg_areyousure"));if(!a){return}ua_data=[];ua_data_reload()}function ua_data_loaddefault(){ua_data=[];gisdefault=true;ua_data_make();ua_data_reload();alert(_i18n("msg_loadeddefault"))}function ua_data_edit(b){if((b<0)||(b>ua_data.length-1)){return}ua_data_current_idx=b;for(var e=0;e<ua_data.length;e++){var f=document.getElementById("tr_ua_data_"+e);if(f){f.bgColor=""}}var f=document.getElementById("tr_ua_data_"+b);if(f){f.bgColor=c_sel_color}var d=document.getElementById("ua_ab");d.value=ua_data[b].ab;d.focus();var d=document.getElementById("ua_name");d.value=ua_data[b].name;var d=document.getElementById("ua_uastring");d.value=ua_data[b].uastring;var d=document.getElementById("btn_ua_data_edit");d.disabled=false}Array.prototype.move=function(c,a){if(a>=this.length){var b=a-this.length;while((b--)+1){this.push(undefined)}}this.splice(a,0,this.splice(c,1)[0]);return this};function ua_data_move(c){var a=ua_data_current_idx;if((a<0)||(a>ua_data.length-1)){alert(_i18n("msg_selectone"));return}if(c==1){var b=a+1;if(b>ua_data.length-1){return}ua_data.move(a,b)}else{var b=a-1;if(b<0){return}ua_data.move(a,b)}ua_data_current_idx=b;ua_data_load();set_notsaved()}function ua_data_del(a){if((a<0)||(a>ua_data.length-1)){return}ua_data.splice(a,1);ua_data_reload()}function ua_data_hide(){var a=this.data;if((a<0)||(a>ua_data.length-1)){return}ua_data[a].hide=this.checked;set_notsaved()}function ua_data_check(){var b=document.getElementById("ua_ab");var d=b.value;if(!d){alert("You have to input flag(abbreviation).");b.focus();return}var b=document.getElementById("ua_name");var c=b.value;if(!c){alert("You have to input name.");b.focus();return}var b=document.getElementById("ua_uastring");var e=b.value;if(!e){alert("You have to input User Agent string.");b.focus();return}return true}function ua_data_edit_ok(){var b=ua_data_current_idx;if((b<0)||(b>ua_data.length-1)){return}if(!ua_data_check()){return}var c=document.getElementById("ua_ab");ua_data[b].ab=c.value;var c=document.getElementById("ua_name");ua_data[b].name=c.value;var c=document.getElementById("ua_uastring");ua_data[b].uastring=c.value;ua_data_load();set_notsaved()}function ua_data_add_ok(){if(!ua_data_check()){return}var c={};var d=document.getElementById("ua_ab");c.ab=d.value;var d=document.getElementById("ua_name");c.name=d.value;var d=document.getElementById("ua_uastring");c.uastring=d.value;ua_data[ua_data.length]=c;ua_data_current_idx=ua_data.length-1;var d=document.getElementById("btn_ua_data_edit");d.disabled=false;ua_data_load();set_notsaved()}var req_pattern=[];var req_pattern_current_idx=-1;var type_default=["main_frame","sub_frame","stylesheet","script","image","object","xmlhttprequest","other"];var type_default_text=["Main frame","Sub frame","Stylesheet","Script","Image","Object","xmlhttprequest","Other"];function req_pattern_make(){try{if(gisdefault){if(req_pattern.length>0){return}s=bgmodule.getStorageDefaults("req_pattern")}else{s=localStorage.req_pattern}req_pattern=[];req_pattern=JSON.parse(s)}catch(c){}var b=document.getElementById("btn_req_pattern_edit");b.disabled=true}function req_pattern_load(){var n='<table width=100% border="1" cellpadding="3" cellspacing="2" bordercolor="silver" style="border-collapse:collapse">';n+="<td><td width=30>"+_i18n("msg_active")+"<td>"+_i18n("msg_pattern")+'<td colspan=2 align=center><a id="fix1_19" href="#" class=alinktext title="'+_i18n("msg_moveup")+'"><img src="images/up.png"></a>&nbsp;&nbsp;<a id="fix1_20" href="#" class=alinktext title="'+_i18n("msg_movedown")+'"><img src="images/down.png"></a>';if(req_pattern.length==0){n=n+"<tr><td colspan=100>No data</td></tr>"}for(var e=0;e<req_pattern.length;++e){var h=req_pattern[e];var m="";for(var d=0;d<h.type.length;++d){for(var b=0;b<type_default.length;++b){if(h.type[d]==type_default[b]){if(m!=""){m=m+", "}m=m+type_default_text[b];break}}}var l="";if(h.data&&(h.data.length>0)){l=h.data[0].value}if(!l){l=_i18n("msg_defaultchrome")}var g='<label><input type=checkbox id="fix1_23_'+e+'"></label>';if(h.active){g='<label><input type=checkbox checked id="fix1_23_'+e+'"></label>'}n=n+'<tr id="tr_patten_'+e+'"><td>'+(e+1)+"<td>"+g+'<td width=800><table width=100% border="1" cellpadding="1" cellspacing="1" bordercolor="silver" style="border-collapse:collapse"><tr><td>'+h.pattern+"<td>"+m+"<tr><td colspan=100>"+l+"</table></td>";n+='<td><label><input type=radio id="fix1_21_'+e+'" name=patternsel title="'+_i18n("msg_select")+'"></label></td>';n=n+'<td><a id="fix1_22_'+e+'" href="#" class=alinktext title="'+_i18n("msg_delete")+'"><img src="images/close.png"></a></td></tr>'}n=n+"</table>";var h=document.getElementById("req_pattern");h.innerHTML=n;_getid("fix1_19").onclick=function(){req_pattern_move(0);return false};_getid("fix1_20").onclick=function(){req_pattern_move(1);return false};for(var e=0;e<req_pattern.length;++e){var h=_getid("fix1_21_"+e);if(h){h.data=e;h.onclick=function(){req_pattern_edit(this.data)}}var h=_getid("fix1_22_"+e);if(h){h.data=e;h.onclick=function(){req_pattern_del(this.data);return false}}var h=_getid("fix1_23_"+e);if(h){h.data=e;h.onclick=function(){req_pattern_active_click(this,this.data)}}}var h=document.getElementsByName("patternsel");for(var e=0;e<h.length;e++){if(req_pattern_current_idx==e){h[e].checked=true;var f=document.getElementById("tr_patten_"+e);if(f){f.bgColor=c_sel_color}break}}}function req_pattern_reload(){req_pattern_current_idx=-1;req_pattern_load();var b=document.getElementById("btn_req_pattern_edit");b.disabled=true;set_notsaved()}function req_pattern_clearall(){var a=confirm(_i18n("msg_areyousure"));if(!a){return}req_pattern=[];req_pattern_reload()}function req_pattern_active_click(b,a){if((a<0)||(a>req_pattern.length-1)){return}req_pattern[a].active=b.checked;set_notsaved()}function req_pattern_edit(e){if((e<0)||(e>req_pattern.length-1)){return}req_pattern_current_idx=e;for(var g=0;g<req_pattern.length;g++){var h=document.getElementById("tr_patten_"+g);if(h){h.bgColor=""}}var h=document.getElementById("tr_patten_"+e);if(h){h.bgColor=c_sel_color}var f=document.getElementById("req_pattern_pattern");f.value=req_pattern[e].pattern;f.focus();for(var g=0;g<type_default.length;++g){var d=document.getElementById("req_pattern_type_"+type_default[g]);if(d){d.checked=false}}for(var g=0;g<req_pattern[e].type.length;++g){var d=document.getElementById("req_pattern_type_"+req_pattern[e].type[g]);if(d){d.checked=true}}var f=document.getElementById("req_pattern_uastring");if(req_pattern[e].data&&(req_pattern[e].data.length>0)){f.value=req_pattern[e].data[0].value}var f=document.getElementById("btn_req_pattern_edit");f.disabled=false}function req_pattern_move(c){var a=req_pattern_current_idx;if((a<0)||(a>req_pattern.length-1)){alert(_i18n("msg_selectone"));return}if(c==1){var b=a+1;if(b>req_pattern.length-1){return}req_pattern.move(a,b)}else{var b=a-1;if(b<0){return}req_pattern.move(a,b)}req_pattern_current_idx=b;req_pattern_load();set_notsaved()}function req_pattern_del(a){if((a<0)||(a>req_pattern.length-1)){return}req_pattern.splice(a,1);req_pattern_reload()}function req_pattern_check(){var b=document.getElementById("req_pattern_pattern");var c=b.value;if(!c){alert("You have to input pattern.");b.focus();return}return true}function req_pattern_edit_ok(){var e=req_pattern_current_idx;if((e<0)||(e>req_pattern.length-1)){return}if(!req_pattern_check()){return}var f=document.getElementById("req_pattern_pattern");req_pattern[e].pattern=f.value;var h=[];for(var g=0;g<type_default.length;++g){var d=document.getElementById("req_pattern_type_"+type_default[g]);if(d){if(d.checked){h[h.length]=type_default[g]}}}req_pattern[e].type=h;var f=document.getElementById("req_pattern_uastring");if(req_pattern[e].data&&(req_pattern[e].data.length>0)){req_pattern[e].data[0].value=f.value}req_pattern_load();set_notsaved()}function req_pattern_add_ok(){if(!req_pattern_check()){return}var e={};var f=document.getElementById("req_pattern_pattern");e.pattern=f.value;var k=[];for(var g=0;g<type_default.length;++g){var j=document.getElementById("req_pattern_type_"+type_default[g]);if(j){if(j.checked){k[k.length]=type_default[g]}}}e.type=k;var f=document.getElementById("req_pattern_uastring");e.data=[];var h={};h.name="User-Agent";h.value=f.value;e.data[0]=h;e.active=true;req_pattern[req_pattern.length]=e;req_pattern_current_idx=req_pattern.length-1;var f=document.getElementById("btn_req_pattern_edit");f.disabled=false;req_pattern_load();set_notsaved()}function ua_data_show_trans(){var b=document.getElementById("div_ua_data_trans");if(b.style.display==""){b.style.display="none"}else{b.style.display=""}}function ua_data_export(){var c=JSON.stringify(ua_data);var b=document.getElementById("txt_ua_data_trans");b.value=c}function ua_data_import(){var d=document.getElementById("txt_ua_data_trans");try{var c=JSON.parse(d.value)}catch(e){alert(_i18n("msg_occurerror"));return}ua_data=c;ua_data_reload();alert("Imported!!")}function req_pattern_show_trans(){var b=document.getElementById("div_req_pattern_trans");if(b.style.display==""){b.style.display="none"}else{b.style.display=""}}function req_pattern_export(){var c=JSON.stringify(req_pattern);var b=document.getElementById("txt_req_pattern_trans");b.value=c}function req_pattern_import(){var d=document.getElementById("txt_req_pattern_trans");try{var c=JSON.parse(d.value)}catch(e){alert(_i18n("msg_occurerror"));return}req_pattern=c;req_pattern_reload();alert("Imported!!")}function proc_onload(){proc_setlang();_getid("viewlog_refreshhotkey").innerHTML=proc_hotkey1_out();_getid("viewlog_refreshhotkey2").innerHTML=proc_hotkey2_out();_getid("viewlog_clearhotkey").innerHTML=proc_hotkey1_out();_getid("viewlog_clearhotkey2").innerHTML=proc_hotkey2_out();_getid("fix1_1").href="https://chrome.google.com/webstore/detail/ljfpjnehmoiabkefmnjegmpdddgcdnpo?hl="+window.navigator.language;_getid("fix1_2").href="https://chrome.google.com/webstore/detail/ljfpjnehmoiabkefmnjegmpdddgcdnpo?hl="+window.navigator.language;_getid("first_form").onsubmit=function(){return false};_getid("btn_ua_data_edit").onclick=ua_data_edit_ok;_getid("fix1_3").onclick=ua_data_add_ok;_getid("fix1_4").onclick=ua_data_loaddefault;_getid("fix1_5").onclick=ua_data_clearall;_getid("fix1_6").onclick=ua_data_show_trans;_getid("fix1_7").onclick=ua_data_export;_getid("fix1_8").onclick=ua_data_import;_getid("fix1_9").onsubmit=function(){return false};_getid("btn_req_pattern_edit").onclick=req_pattern_edit_ok;_getid("fix1_10").onclick=req_pattern_add_ok;_getid("fix1_11").onclick=req_pattern_clearall;_getid("fix1_12").onclick=req_pattern_export;_getid("fix1_13").onclick=req_pattern_import;_getid("fix1_14").onsubmit=function(){return false};_getid("btn_saveOptions1").onclick=saveOptions;_getid("btn_closeoption1").onclick=closeoption;_getid("btn_setdefault1").onclick=setdefault;_getid("btn_saveOptions2").onclick=saveOptions;_getid("btn_closeoption2").onclick=closeoption;_getid("btn_setdefault2").onclick=setdefault;ua_data_make();req_pattern_make();presetValues(false);init()}window.onload=proc_onload;function windowonscroll(){var g=document.getElementById("float_saveoptions");g.style.position="fixed";var f=document.getElementById("main_table");var e=document.getElementById("first_form");var j=0;while(e&&!isNaN(e.offsetTop)){j+=e.offsetTop;e=e.offsetParent}var d=f.offsetLeft+f.offsetWidth;var h=document.body.scrollTop+10;if(h<j){h=j-document.body.scrollTop}else{h=10}g.style.left=d+"px";g.style.top=h+"px";g.style.display=""}window.onscroll=windowonscroll;function windowonresize(){var a=document.getElementById("layer_message");if(a){a.style.display="none"}var a=document.getElementById("layer_message2");if(a){a.style.display="none"}var a=document.getElementById("layer_message3");if(a){a.style.display="none"}windowonscroll()}window.onresize=windowonresize;chrome.extension.onRequest.addListener(function(e,d,b){if(e.action=="config_changed"){var c=document.getElementById("req_pattern_enable2");if(c){c.checked=bgmodule.g_config.req_pattern_enable2}}});