<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Server | Was ich so treibe...]]></title>
  <link href="http://uli-heller.github.com/blog/categories/server/atom.xml" rel="self"/>
  <link href="http://uli-heller.github.com/"/>
  <updated>2013-08-07T10:00:49+02:00</updated>
  <id>http://uli-heller.github.com/</id>
  <author>
    <name><![CDATA[Uli Heller]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[WLAN-Konfiguration beim Ubuntu-Server]]></title>
    <link href="http://uli-heller.github.com/blog/2013/06/14/ubuntu-server-wlan/"/>
    <updated>2013-06-14T12:00:00+02:00</updated>
    <id>http://uli-heller.github.com/blog/2013/06/14/ubuntu-server-wlan</id>
    <content type="html"><![CDATA[<p>Meinen alten EEEPC würde ich gerne als DHCP-Server weiterverwenden.
Also: Ubuntu-12.04-Server drauf und los geht&rsquo;s. Dumm nur:
Aktuell ist unklar, wie ich die WLAN-Konfiguration hinbekomme.
Auf Desktop-Systemen macht man das ja mit dem NetworkManager,
was auf dem Server ohne graphische Benutzerschnittstelle schwierig ist.</p>

<!-- more -->


<h2>Vorbereitungen</h2>

<p>Auf dem EEEPC habe ich diese Grundinstallation vorgenommen:</p>

<ul>
<li>Ubuntu-12.04.2 Server, 32 bit</li>
<li>Raring-Kernel</li>
<li>Alle Aktualisierungen vom heutigen Tage (2013-06-14)</li>
</ul>


<h2>Grundtests</h2>

<p>Die Grundtests habe ich von hier: <a href="http://ubuntuforums.org/showthread.php?t=1094204">http://ubuntuforums.org/showthread.php?t=1094204</a></p>

<p>{% codeblock Grundtests %}
$ sudo -s</p>

<h1>ifconfig wlan0 up</h1>

<h1>iwlist scan</h1>

<p>wlan0     Scan completed :</p>

<pre><code>      Cell 01 - Address: 00:3f:c6:3c:dd:a2
                Channel:1
                Frequency:2.412 GHz (Channel 1)
                Quality=37/70  Signal level=-73 dBm  
                Encryption key:on
                ESSID:"SiegfriedUndRoy"
</code></pre>

<p>&hellip;
{% endcodeblock %}</p>

<h2>Konfiguration als WLAN-Client</h2>

<p>Die Konfiguration habe ich hierher:
<a href="http://ubuntuforums.org/showthread.php?t=2007475">http://ubuntuforums.org/showthread.php?t=2007475</a>.
Sie ist gegenüber der Vorlage leicht abgewandelt.</p>

<p>{% codeblock /etc/network/interfaces %}
&hellip;
auto wlan0
iface wlan0 inet dhcp
  wpa-ssid SiegfriedUndRoy
  wpa-psk  SharpTiger
{% endcodeblock %}</p>

<p>Hierbei muß nach &ldquo;wpa-ssid&rdquo; der Name des zu verwendenden Funknetzwerkes
eingetragen werden und bei &ldquo;wpa-psk&rdquo; das dabei zu verwendende Kennwort.
Bevor Fragen aufkommen: &ldquo;SiegfriedUndRoy&rdquo; und &ldquo;SharpTiger&rdquo; sind erfundene
Werte.</p>

<p>Nun muß nur noch das WLAN-Interface aktiviert werden.</p>

<p>{% codeblock WLAN-Interface aktivieren lang:sh %}</p>

<h1>ifdown wlan0 # Fehlermeldung ignorieren</h1>

<h1>ifup wlan0   # Hier darf keine Fehlermeldung erscheinen</h1>

<p>ssh stop/waiting
ssh start/running, process 1202</p>

<h1>ifconfig wlan0</h1>

<p>wlan0     Link encap:Ethernet  HWaddr 00:3f:c6:3c:dd:a2</p>

<pre><code>      inet addr:192.168.178.27  Bcast:192.168.178.255  Mask:255.255.255.0
      inet6 addr: fe80::215:afff:fe88:ab6d/64 Scope:Link
      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
      RX packets:696 errors:0 dropped:0 overruns:0 frame:0
      TX packets:496 errors:0 dropped:0 overruns:0 carrier:0
      collisions:0 txqueuelen:1000 
      RX bytes:526709 (526.7 KB)  TX bytes:66404 (66.4 KB)
</code></pre>

<p>{% endcodeblock %}</p>

<p>Wichtig ist, dass bei &ldquo;inet addr:&rdquo; eine IP-Adresse ähnlich der bei
mir angezeigten 192.168.178.27 steht. Wie&rsquo;s aussieht funktioniert&rsquo;s schon!</p>

<h2>Konfiguration als Access-Point</h2>

<p>Grob gehe ich nach dieser Anleitung vor: <a href="http://wiki.ubuntuusers.de/WLAN_Router">http://wiki.ubuntuusers.de/WLAN_Router</a></p>

<h3>Zusatzpakete installieren</h3>

<p>{% codeblock Zusatzpakete installieren lang:sh %}
$ sudo apt-get install -y hostapd dnsmasq
Paketlisten werden gelesen&hellip; Fertig
Abhängigkeitsbaum wird aufgebaut     <br/>
Statusinformationen werden eingelesen&hellip; Fertig
Die folgenden Pakete wurden automatisch installiert und werden nicht mehr benötigt:
  crda wireless-regdb
Verwenden Sie »apt-get autoremove«, um sie zu entfernen.
Die folgenden zusätzlichen Pakete werden installiert:
  dnsmasq-base libnetfilter-conntrack3
Die folgenden NEUEN Pakete werden installiert:
  dnsmasq dnsmasq-base hostapd libnetfilter-conntrack3
&hellip;
hostapd (1:0.7.3-4ubuntu1) wird eingerichtet &hellip;
Trigger für libc-bin werden verarbeitet &hellip;
ldconfig deferred processing now taking place
{% endcodeblock %}</p>

<h3>Konfiguration von hostapd</h3>

<p>Zunächst muß die Datei /etc/default/hostapd
wie folgt modifiziert werden:</p>

<p>{% codeblock /etc/default/hostapd lang:diff %}</p>

<h1>diff -u /etc/default/hostapd.orig /etc/default/hostapd</h1>

<p>&mdash;&ndash; hostapd.orig    2013-06-14 13:26:20.390584872 +0200
+++ hostapd 2013-06-14 13:27:14.698854220 +0200
@@ -7,7 +7,8 @@
 # file and hostapd will be started during system boot. An example configuration
 # file can be found at /usr/share/doc/hostapd/examples/hostapd.conf.gz
 #
&ndash;#DAEMON_CONF=&ldquo;&rdquo;
+DAEMON_CONF=&ldquo;/etc/hostapd.conf&rdquo;
+RUN_DAEMON=yes</p>

<p> # Additional daemon options to be appended to hostapd command:&ndash;
 #  -d   show more debug messages (-dd for even more)
{% endcodeblock %}</p>

<p>Dann brauchen wir zusätzlich noch die Konfigurationsdatei
/etc/hostapd.conf. Das Grundgerüst habe ich von hier:
<a href="http://wiki.ubuntuusers.de/WLAN_Router">http://wiki.ubuntuusers.de/WLAN_Router</a></p>

<p>{% codeblock /etc/hostapd.conf lang:text %}</p>

<h1>Schnittstelle und Treiber</h1>

<p>interface=wlan0
driver=nl80211</p>

<h1>WLAN-Konfiguration</h1>

<p>ssid=HaeberleUndPfleiderer
channel=1</p>

<h1>ESSID sichtbar</h1>

<p>ignore_broadcast_ssid=0</p>

<h1>Ländereinstellungen</h1>

<p>country_code=DE
ieee80211d=1</p>

<h1>Übertragungsmodus</h1>

<p>hw_mode=g</p>

<h1>Optionale Einstellungen</h1>

<h1>supported_rates=10 20 55 110 60 90 120 180 240 360 480 540</h1>

<h1>Draft-N Modus aktivieren / optional nur für entsprechende Karten</h1>

<h1>ieee80211n=1</h1>

<h1>Übertragungsmodus / Bandbreite 40MHz</h1>

<h1>ht_capab=[HT40+][SHORT-GI-40][DSSS_CCK-40]</h1>

<h1>Beacons</h1>

<p>beacon_int=100
dtim_period=2</p>

<h1>MAC-Authentifizierung</h1>

<p>macaddr_acl=0</p>

<h1>max. Anzahl der Clients</h1>

<p>max_num_sta=20</p>

<h1>Größe der Datenpakete/Begrenzung</h1>

<p>rts_threshold=2347
fragm_threshold=2346</p>

<h1>hostapd Log Einstellungen</h1>

<p>logger_syslog=-1
logger_syslog_level=2
logger_stdout=-1
logger_stdout_level=2</p>

<h1>temporäre Konfigurationsdateien</h1>

<p>dump_file=/tmp/hostapd.dump
ctrl_interface=/var/run/hostapd
ctrl_interface_group=0</p>

<h1>Authentifizierungsoptionen</h1>

<p>auth_algs=3</p>

<h1>wmm-Funktionalität</h1>

<p>wmm_enabled=0</p>

<h1>Verschlüsselung / hier rein WPA2</h1>

<p>wpa=2
rsn_preauth=1
rsn_preauth_interfaces=wlan0
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP</p>

<h1>Schlüsselintervalle / Standardkonfiguration</h1>

<p>wpa_group_rekey=600
wpa_ptk_rekey=600
wpa_gmk_rekey=86400</p>

<h1>Zugangsschlüssel (PSK) / hier in Klartext (ASCII)</h1>

<p>wpa_passphrase=ScharfesTigerle
{% endcodeblock %}</p>

<h3>Konfiguration der Netzwerkschnittstelle</h3>

<p>{% codeblock /etc/network/interfaces %}
&hellip;
auto wlan0
iface wlan0 inet static
  address 192.168.3.1
  netmask 255.255.255.0
  broadcast 192.168.3.255</p>

<h1>hostap und dnsmasq neu starten</h1>

<p>up /etc/init.d/hostapd restart
up /etc/init.d/dnsmasq restart
{% endcodeblock %}</p>

<h3>Konfiguration von dnsmasq</h3>

<p>{% codeblock /etc/dnsmasq.conf lang:diff %}</p>

<h1>diff -u /etc/dnsmasq.conf.orig /etc/dnsmasq.conf</h1>

<p>&mdash;&ndash; /etc/dnsmasq.conf.orig  2013-06-14 13:57:34.856639712 +0200
+++ /etc/dnsmasq.conf   2013-06-14 13:58:18.400855636 +0200
@@ -142,7 +142,7 @@
 # a lease time. If you have more than one network, you will need to
 # repeat this for each network on which you want to supply DHCP
 # service.
&ndash;#dhcp-range=192.168.0.50,192.168.0.150,12h
+dhcp-range=192.168.3.50,192.168.3.150,12h</p>

<p> # This is an example of a DHCP range where the netmask is given. This
 # is needed for networks we reach the dnsmasq DHCP server via a relay
{% endcodeblock %}</p>

<h3>Test</h3>

<p>Nach der Konfiguration erfolgt ein Neustart mit <code>sudo reboot</code>. Danach
kann man sich am WLAN &ldquo;HaeberleUndPfleiderer&rdquo; mit
dem Kennwort &ldquo;ScharfesTigerle&rdquo; anmelden.</p>

<ul>
<li>IP-Adresse: <code>ifconfig wlan0</code> &ndash; 192.168.3.115</li>
<li>SSH-Zugriff: <code>ssh 192.168.3.1</code> &ndash; klappt</li>
</ul>

]]></content>
  </entry>
  
</feed>
