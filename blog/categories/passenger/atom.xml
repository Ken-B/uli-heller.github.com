<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Passenger | Was ich so treibe...]]></title>
  <link href="http://uli-heller.github.com/blog/categories/passenger/atom.xml" rel="self"/>
  <link href="http://uli-heller.github.com/"/>
  <updated>2013-08-07T10:00:49+02:00</updated>
  <id>http://uli-heller.github.com/</id>
  <author>
    <name><![CDATA[Uli Heller]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Redmine: Von FCGI zu Passenger]]></title>
    <link href="http://uli-heller.github.com/blog/2013/07/19/redmine-passenger/"/>
    <updated>2013-07-19T15:00:00+02:00</updated>
    <id>http://uli-heller.github.com/blog/2013/07/19/redmine-passenger</id>
    <content type="html"><![CDATA[<p>Bislang habe ich Redmine hinter einem Apache HTTPD via FCGI betrieben.
Bei meinen Tests mit Redmine-2.3.2 gibt es bei dieser Konstellation aber
viele Probleme mit der Selektion des Rails-Environments. Es wird immer
&ldquo;development&rdquo; verwendet, &ldquo;production&rdquo; kann nicht mehr &ldquo;wie früher&rdquo; über
&ldquo;environment.rb&rdquo; und <code>ENV['RAILS_ENV'] ||= 'production'</code> selektiert werden.</p>

<!-- more -->


<h2>Sichtung der Alt-Version</h2>

<p>Zunächst muß sichergestellt werden, dass die alte Version hinreichend
gut funktioniert:</p>

<ul>
<li>Redmine-VM starten</li>
<li>LDAP-VM starten</li>
<li>Browser: <a href="http://192.168.56.97">http://192.168.56.97</a> &ndash;> &ldquo;It works&rdquo;</li>
<li>Browser: <a href="http://192.168.56.97/redmine">http://192.168.56.97/redmine</a> &ndash;> Begrüssung von Redmine</li>
<li>Browser: <a href="http://192.168.56.97/redmine/issues/1">http://192.168.56.97/redmine/issues/1</a> &ndash;> Anmeldungseite wird angezeigt; Anmeldung funktioniert</li>
</ul>


<p>Soweit sieht alles ganz OK aus. Nun: Sichtung der Programmstände.</p>

<p>{% codeblock lang:sh %}
$ ruby -v
ruby 1.8.7 (2010-01-10 patchlevel 249) [i486-linux]
$ gem list</p>

<p><strong><em> LOCAL GEMS </em></strong></p>

<p>actionmailer (2.3.17)
actionpack (2.3.17)
activerecord (2.3.17)
activeresource (2.3.17)
activesupport (2.3.17)
i18n (0.4.2)
mysql (2.8.1)
rack (1.1.3)
rails (2.3.17)
rake (0.8.7)
rubygems-update (1.6.2)
{% endcodeblock %}</p>

<h2>Ruby-Gems herunterladen und installieren</h2>

<p>Mit diesen Befehlen werden die Ruby-Gems heruntergeladen:</p>

<p>{% codeblock lang:sh %}
gem fetch passenger</p>

<h1>gem fetch passenger -v 4.0.10</h1>

<p>gem fetch daemon_controller -v &ldquo;>= 1.1.0&rdquo;</p>

<h1>gem fetch daemon_controller -v 1.1.4</h1>

<p>{% endcodeblock %}</p>

<p>Die *.gem-Dateien müssen auf die Redmine-VM übertragen werden, am besten
mit <code>scp</code>. Danach spielt man sie ein mit</p>

<p>{% codeblock lang:sh %}
gem install passenger-4.0.10.gem
{% endcodeblock %}</p>

<h2>Apache-Modul installieren</h2>

<p>Mit nachfolgendem Befehl wird das Passenger-Modul für Apache2
installiert und auch gleich aktiviert:</p>

<p>{% codeblock lang:sh %}
apt-get install libapache2-mod-passenger
{% endcodeblock %}</p>

<h2>Apache konfigurieren</h2>

<ul>
<li><p>Konfigurationsdatei kopieren und anpassen:
<code>cp /etc/apache2/sites-available/default /etc/apache2/sites-available/passenger</code></p>

<pre><code>{% codeblock /etc/apache2/sites-available/passenger lang:text %}
</code></pre>

<h1>NameVirtualHost *:80</h1>

<p><VirtualHost *:80>
      ServerAdmin webmaster@localhost</p>

<pre><code>  PassengerDefaultUser www-data
  RailsEnv production
</code></pre>

<h1>RailsBaseURI /redmine</h1>

<pre><code>  DocumentRoot /srv/redmine-1.2.1/public/
</code></pre>

<h1>DocumentRoot /var/www/</h1>

<pre><code>  Alias /redmine "/srv/redmine-1.2.1/public/"
  &lt;Directory "/srv/redmine-1.2.1/public/"&gt;   
   Options FollowSymLinks -MultiViews  
    AllowOverride none  
    Order allow,deny
    allow from all
  &lt;/Directory&gt;

  ErrorLog /var/log/apache2/error.log

  # Possible values include: debug, info, notice, warn, error, crit,
  # alert, emerg.
  LogLevel warn  

  CustomLog /var/log/apache2/access.log combined
  ServerSignature On
</code></pre>

<p></VirtualHost>
    {% endcodeblock %}</p></li>
<li><p>Alte Datei &ldquo;abklemmen&rdquo;: <code>a2dissite default</code></p></li>
<li><p>Neue Datei aktivieren: <code>a2ensite passenger</code></p></li>
<li><p>Apache neu starten: <code>/etc/init.d/apache2 restart</code></p></li>
</ul>


<h2>Sichtung der Neu-Version</h2>

<p>Zunächst muß sichergestellt werden, dass die alte Version hinreichend
gut funktioniert:</p>

<ul>
<li>Redmine-VM starten (&hellip; läuft vermutlich eh' noch)</li>
<li>LDAP-VM starten (&hellip; läuft vermutlich eh' noch)</li>
<li>Browser: <a href="http://192.168.56.97">http://192.168.56.97</a>  &ndash;> Begrüssung von Redmine</li>
<li>Browser: <a href="http://192.168.56.97/redmine">http://192.168.56.97/redmine</a> &ndash;> Begrüssung von Redmine</li>
<li>Browser: <a href="http://192.168.56.97/redmine/issues/1">http://192.168.56.97/redmine/issues/1</a> &ndash;> Anmeldungseite wird angezeigt; Anmeldung funktioniert</li>
</ul>

]]></content>
  </entry>
  
</feed>
